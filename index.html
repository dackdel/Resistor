<!doctype html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="description" content="Calculate resistor values for a 4band and 5band resistors">
	<meta name="Ankkit Modi" content="Resistor Calculator">
	<title>Resistor Calculator</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href='http://fonts.googleapis.com/css?family=Share+Tech' rel='stylesheet' type='text/css'>

	</head>
	<body>

    	<div id="band4" class="left">
			<object id="res4" class="emb4" data="resistor.svg" width="500" height="500" type="image/svg+xml"></object>
		</div>
		<div id="band5" class="right">
			<object id="res5" class="emb5" data="resistor5.svg" width="500" height="500" type="image/svg+xml"></object>
		</div>
		<div class="center">
			<input id="resistance" class="input" placeholder="resistor value, tolerance | example: 220k, Â±5%"/>
			<button id="btn" class="button" >RESIST</button>
		</div>

		<script src="jQuery.js"></script>
		<script src="resistor.js"></script>
		<script type="text/javascript" src="sb-1.2.0.js"></script>
		<script type="text/javascript">
			sb = new Spacebrew.Client('192.168.1.190', 'Resistor Read');
        	sb.addSubscribe('resistor value', 'string');
        	sb.connect();
        	sb.onStringMessage = function onStringMessage(name, value){
	        	if(name=='resistor value') {
	        		console.log("Resistor Value: "+value);
	        		$("#resistance").val(value);
					$("#btn").click();
	        	}
			}

			$(function() {
				var colourMap = {
					black:"#000000",
					brown:"#663332",
					red: "#fe0000",
					orange: "#ff6600",
					yellow: "#ffff01", 
					green: "#33cc33",
					blue: "#6766ff",
					violet: "#cd66ff",
					grey: "#939393",
					white: "#ffffff",
					gold: "#cc9832",
					silver: "#cccccc"
				};
				
				$("#btn").on("click",go4);
				$("#btn").on("click",go5);
				
				function go4(){
					var colours = getColoursFromInput();

					getBand(4, 1).setAttribute("fill", colourMap[colours.band1] );
					getBand(4, 2).setAttribute("fill", colourMap[colours.band2] );
					getBand(4, 3).setAttribute("fill", colourMap[colours.band3] );
					getBand(4, 4).setAttribute("fill", colourMap[colours.band5] );
				}

				function go5(){
					var colours = getColoursFromInput();

					getBand(5, 1).setAttribute("fill",colourMap[colours.band1] );
					getBand(5, 2).setAttribute("fill",colourMap[colours.band2] );
					getBand(5, 3).setAttribute("fill",colourMap[colours.band3] );
					getBand(5, 4).setAttribute("fill",colourMap[colours.band4] );
					getBand(5, 5).setAttribute("fill",colourMap[colours.band5] );
				}

				function getColoursFromInput() {
					var values = $("#resistance").val().replace(/\s+/g, "").split(",");
					var resistance = values[0];
					var tolerance = parseInt(values[1], 10);
					var colours = resistor.resistorToColor(resistance, tolerance);

					console.log(resistance, tolerance, colours);
					return colours;
				}

				function getBand(bands, index) {
					var svg = document.getElementById('res' + bands);
					var band = svg.getSVGDocument().querySelector('#band' + index);
					return band;
				}

				$("#resistance").on("input", function() {
					updateResistorInput();
				});

				function updateResistorInput() {

					var $res = $('#resistance');
					var resistance = $res.val();
					var matches = resistance.match( /^\s*([\d.]+) ?[kmKM]?\s*$/ );
					console.log( matches );

					if( matches && matches.length > 0 ) {
						$res.addClass('correct');
						$res.removeClass('incorrect');
						go4();
						go5();
					}
					else {
						$res.addClass('incorrect');
						$res.removeClass('correct');
					}
				}

			});
		</script>
	</body>
</html>